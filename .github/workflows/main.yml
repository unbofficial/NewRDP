- name: Install and Start Ngrok
        run: |
          choco install ngrok -y
          
          # Auth Token ko verify karein (Ye step check karega ki secret mil raha hai ya nahi)
          if ("${{ secrets.NGROK_AUTH_TOKEN }}" -eq "") {
            Write-Error "NGROK_AUTH_TOKEN is empty! Please add it to GitHub Secrets."
            exit 1
          }

          ngrok config add-authtoken "${{ secrets.NGROK_AUTH_TOKEN }}"
          
          # Tunnel ko specific region (us) ke saath start karein
          Write-Host "Starting Ngrok tunnel..."
          Start-Process ngrok -ArgumentList "tcp --region us 3389"
          
          # Wait time badha diya taaki tunnel stable ho jaye
          Start-Sleep -Seconds 20

      - name: Get Connection Address
        run: |
          # Debugging: Check if Ngrok process is even running
          $process = Get-Process ngrok -ErrorAction SilentlyContinue
          if (!$process) {
            Write-Error "Ngrok process failed to start. Check your Auth Token."
            exit 1
          }

          try {
            $tunnels = Invoke-RestMethod http://localhost:4040/api/tunnels
            $address = $tunnels.tunnels[0].public_url
            
            $cleanAddress = $address.Replace("tcp://", "")
            
            Write-Host "=============================="
            Write-Host "ðŸš€ CONNECT NOW:"
            Write-Host "ADDRESS: $cleanAddress"
            Write-Host "USER: RDPUser"
            Write-Host "PASS: MySafePass123!"
            Write-Host "=============================="
          }
          catch {
            # Agar fail ho, toh Ngrok ke internal logs dekhein
            Write-Host "Failed to get address. Fetching Ngrok logs..."
            curl.exe http://localhost:4040/api/tunnels
            exit 1
          }
